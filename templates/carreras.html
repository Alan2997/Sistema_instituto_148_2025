<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Carreras - Sistema de Gestión Académica</title>

  <!-- Fuentes y Bootstrap -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">

  <script>
    function showTab(tabName) {
      const tabs = document.querySelectorAll('.tab-content');
      tabs.forEach(tab => tab.style.display = 'none');

      const activeTab = document.getElementById(tabName);
      if (activeTab) {
        activeTab.style.display = 'block';
      }

      const tabButtons = document.querySelectorAll('.tabs button');
      tabButtons.forEach(button => button.classList.remove('active'));
      document.getElementById(tabName + '-btn').classList.add('active');
    }

    window.onload = function() {
      const table = '{{ table }}';  
      if (table === 'carreras_inactivas') {
        showTab('carreras_inactivas');
      } else {
        showTab('carreras');  // por defecto mostramos carreras
      }
    };
  </script>

  <style>
    html {
      margin-left: 15%;
      margin-top: 10%;
      height: 60%;
      align-items: center;
    }
    html, body {
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    #boton-guardar {
      background-color: #518ec3;
      color: #fff;
    }
  </style>
</head>
<body>
  {% include 'navbar.html' %}
  <div class="container">
    {% include 'nav_carreras.html' %}
  </div>

  <div class="container align-content-center align-items-center">

    <!-- Contenido de la pestaña de Carreras -->
    <div id="carreras" class="tab-content" style="display: none;">
      <h5 class="text-primary mt-5">Listado de Carreras</h5>

      <div class="d-flex justify-content-between align-items-center mb-3">
  
      <!-- Formulario de búsqueda y filtros -->
      <form method="GET" action="{{ url_for('carreras') }}" class="form-inline">
        <input type="hidden" name="table" value="carreras">
        <input type="text" name="nombre" class="form-control mr-2" placeholder="Buscar por nombre" value="{{ nombre_busqueda or '' }}">
        
        <!-- Filtro de estado -->
        <label class="mr-2">Estado:</label>
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="activo" value="todos" id="todos" {% if estado_activo == 'todos' %}checked{% endif %}>
            <label class="form-check-label" for="todos">Todos</label>
          </div>
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="activo" value="activos" id="activos" {% if estado_activo == 'activos' %}checked{% endif %}>
            <label class="form-check-label" for="activos">Activos</label>
          </div>
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="activo" value="inactivos" id="inactivos" {% if estado_activo == 'inactivos' %}checked{% endif %}>
            <label class="form-check-label" for="inactivos">Inactivos</label>
          </div>

          <button type="submit" class="btn btn-primary ml-2">
            <i class="fas fa-search"></i> Buscar
          </button>
        </form>

        <!-- Botón de agregar a la derecha -->
        <a href="{{ url_for('agregar_carrera') }}" class="btn btn-success" data-toggle="modal" data-target="#modalAgregarCarrera">
          <i class="fas fa-plus"></i> Agregar
        </a>
      </div>


      <!-- Tabla de carreras -->
      <table class="table table-striped">
        <thead>
          <tr>
            <th>N°</th>
            <th>Nombre</th>
            <th>Descripción</th>
            <th>Tipo</th>
            <th>Año</th>
            <th>Ley</th>
            <th>Fecha</th>
            <th>Activo</th>
            <!-- <th>Editar</th>
            <th>Eliminar</th> -->
          </tr>
        </thead>
        <tbody>
          {% for carrera in carreras %}
          <tr>
            {% for campo in carrera %}
            <td>{{ campo or '' }}</td>
            {% endfor %}
            <td>
              <a href="#"
                class="btn btn-sm btn-primary"
                data-toggle="modal"
                data-target="#modalEditarCarrera"
                data-id="{{ carrera[0] }}"
                data-nombre="{{ carrera[1] }}"
                data-descripcion="{{ carrera[2] }}"
                data-tipo="{{ carrera[3] }}"
                data-anio="{{ carrera[4] }}"
                data-fecha="{{ carrera[6] }}"
                data-activo="{{ carrera[7] }}">
                <i class="fas fa-edit fa-lg"></i>
              </a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

      <!-- Paginación de Carreras -->
      {% if total_paginas_carreras %}
      <div class="pagination" id="clase-paginas">
        <ul class="pagination">
          {% for p in range(1, total_paginas_carreras + 1) %}
          <li class="page-item {% if p == page %}active{% endif %}" id="cuadrito">
            <a class="page-link" href="{{ url_for('carreras', page=p, table='carreras', activo=estado_activo, nombre=nombre_busqueda) }}">{{ p }}</a>
          </li>
          {% endfor %}
        </ul>
      </div>
      {% endif %}
    </div>

  </div>

    <!-- Modal Nueva Carrera -->
    <div class="modal fade" id="modalAgregarCarrera" tabindex="-1" role="dialog" aria-labelledby="modalAgregarCarreraLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">

          <div class="modal-header">
            <h5 class="modal-title text-primary" id="modalAgregarCarreraLabel">Nueva Carrera</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Cerrar">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>

          <form method="POST" action="{{ url_for('agregar_carrera') }}" enctype="multipart/form-data">
            <div class="modal-body">
              <div class="form-row">
                <div class="col-md-6 form-group">
                  <label for="nombre">Nombre</label>
                  <input type="text" class="form-control form-control-sm" id="nombre" name="nombre" required>
                </div>
                <div class="col-md-6 form-group">
                  <label for="descripcion">Descripción</label>
                  <input type="text" class="form-control form-control-sm" id="descripcion" name="descripcion">
                  <!-- <textarea class="form-control form-control-sm" id="descripcion" name="descripcion" rows="2"></textarea> -->
                </div>
                <div class="col-md-4 form-group">
                  <label for="tipo">Tipo</label>
                  <input type="text" class="form-control form-control-sm" id="tipo" name="tipo">
                </div>
                <div class="col-md-4 form-group">
                  <label for="anio">Año</label>
                  <input type="number" class="form-control form-control-sm" id="anio" name="anio">
                </div>
                <div class="col-md-4 form-group">
                  <label for="fecha">Fecha</label>
                  <input type="date" class="form-control form-control-sm" id="fecha" name="fecha">
                </div>
                <div class="col-md-12 form-group">
                  <label for="ley">Ley</label>
                  <input type="file" class="form-control form-control-sm" id="ley" name="ley">
                </div>
              </div>
            </div>

            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
              <button type="submit" class="btn" id="boton-guardar">Guardar</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Modal Editar Carrera -->
    <div class="modal fade" id="modalEditarCarrera" tabindex="-1" role="dialog" aria-labelledby="modalEditarCarreraLabel" aria-hidden="true">
      <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">

          <div class="modal-header">
            <h5 class="modal-title text-primary" id="modalEditarCarreraLabel">Editar Carrera</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Cerrar">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>

          <form method="POST" action="{{ url_for('editar_carrera') }}" enctype="multipart/form-data">
            <div class="modal-body">
              <input type="hidden" name="id_carrera" id="editar-id_carrera">
              
              <div class="form-row">
                <div class="col-md-6 form-group">
                  <label for="editar-nombre">Nombre</label>
                  <input type="text" class="form-control form-control-sm" id="editar-nombre" name="nombre" required>
                </div>
                <div class="col-md-6 form-group">
                  <label for="editar-descripcion">Descripción</label>
                  <input type="text" class="form-control form-control-sm" id="editar-descripcion" name="descripcion">
                </div>
                <div class="col-md-4 form-group">
                  <label for="editar-tipo">Tipo</label>
                  <input type="text" class="form-control form-control-sm" id="editar-tipo" name="tipo">
                </div>
                <div class="col-md-4 form-group">
                  <label for="editar-anio">Año</label>
                  <input type="number" class="form-control form-control-sm" id="editar-anio" name="anio">
                </div>
                <div class="col-md-4 form-group">
                  <label for="editar-fecha">Fecha</label>
                  <input type="date" class="form-control form-control-sm" id="editar-fecha" name="fecha">
                </div>
                <div class="col-md-12 form-group">
                  <label for="editar-ley">Ley</label>
                  <input type="file" class="form-control form-control-sm" id="editar-ley" name="ley">
                </div>
                <div class="col-md-12 form-group">
                  <label>Activo</label>
                  <select class="form-control form-control-sm" name="activo" id="editar-activo">
                    <option value="1">Sí</option>
                    <option value="0">No</option>
                  </select>
                </div>
              </div>
            </div>

            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancelar</button>
              <button type="submit" class="btn btn-primary">Guardar cambios</button>
            </div>
          </form>
        </div>
      </div>
    </div>


    <!-- Contenido de la pestaña de Cursos -->
    <div id="cursos" class="tab-content" style="display: none;">
      <h5 class="text-primary mt-5">Listado de Cursos</h5>

      <div class="d-flex justify-content-between align-items-center mb-3">
        <!-- Formulario de búsqueda y filtros -->
        <form method="GET" action="{{ url_for('cursos') }}" class="form-inline">
          <input type="hidden" name="table" value="cursos">
          <input type="text" name="nombre" class="form-control mr-2" placeholder="Buscar por nombre" value="{{ nombre_busqueda or '' }}">
          
          <!-- Filtro de estado -->
          <label class="mr-2">Estado:</label>
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="activo" value="todos" id="todos_cursos" {% if estado_activo == 'todos' %}checked{% endif %}>
            <label class="form-check-label" for="todos_cursos">Todos</label>
          </div>
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="activo" value="activos" id="activos_cursos" {% if estado_activo == 'activos' %}checked{% endif %}>
            <label class="form-check-label" for="activos_cursos">Activos</label>
          </div>
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="activo" value="inactivos" id="inactivos_cursos" {% if estado_activo == 'inactivos' %}checked{% endif %}>
            <label class="form-check-label" for="inactivos_cursos">Inactivos</label>
          </div>

          <button type="submit" class="btn btn-primary ml-2">
            <i class="fas fa-search"></i> Buscar
          </button>
        </form>

        <!-- Botón de agregar -->
        <a href="#" class="btn btn-success" data-toggle="modal" data-target="#modalAgregarCurso">
          <i class="fas fa-plus"></i> Agregar
        </a>
      </div>

      <!-- Tabla de cursos -->
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Nombre</th>
            <th>Año Calendario</th>
            <th>Activo</th>
            <!-- <th>Editar</th> -->
          </tr>
        </thead>
        <tbody>
          {% if cursos %}
            {% for curso in cursos %}
            <tr>
              <td>{{ curso[0] }}</td>
              <td>{{ curso[1] }}</td>
              <td>{{ curso[2] }}</td>
              <td>{{ curso[3] }}</td>
              <td>{{ 'Sí' if curso[4] == 1 else 'No' }}</td>
              <td>
                <a href="{{ url_for('editar_curso', id_curso=curso[0]) }}">
                  <i class="fas fa-edit fa-lg" id="EditIcon"></i>
                </a>
              </td>
            </tr>
            {% endfor %}
          {% else %}
            <tr>
              <td colspan="6" class="text-center text-muted">No hay cursos disponibles</td>
            </tr>
          {% endif %}
        </tbody>
      </table>

      <!-- Paginación -->
      {% if total_paginas_cursos %}
      <div class="pagination" id="clase-paginas">
        <ul class="pagination">
          {% for p in range(1, total_paginas_cursos + 1) %}
          <li class="page-item {% if p == page %}active{% endif %}" id="cuadrito">
            <a class="page-link" href="{{ url_for('cursos', page=p, table='cursos', activo=estado_activo, nombre=nombre_busqueda) }}">{{ p }}</a>
          </li>
          {% endfor %}
        </ul>
      </div>
      {% endif %}
    </div>

    



  <!-- Scripts -->
   <script>
    $('#modalEditarCarrera').on('show.bs.modal', function (event) {
      var button = $(event.relatedTarget); // Botón que abrió el modal
      var modal = $(this);

      // Llenar campos
      modal.find('#editar-id_carrera').val(button.data('id'));
      modal.find('#editar-nombre').val(button.data('nombre'));
      modal.find('#editar-descripcion').val(button.data('descripcion'));
      modal.find('#editar-tipo').val(button.data('tipo'));
      modal.find('#editar-anio').val(button.data('anio'));
      modal.find('#editar-fecha').val(button.data('fecha'));
      modal.find('#editar-activo').val(button.data('activo'));
    });
  </script>

  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.0.6/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script src="bootstrap.bundle.min.js"></script>
</body>
</html>
